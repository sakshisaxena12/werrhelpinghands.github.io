<!doctype html>
<html class="no-js" lang="">



<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Login with US</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="#">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./stylesheets/bootstrap.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="./stylesheets/fontawesome-all.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="font/flaticon.css">
    <!-- Google Web Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./stylesheets/stylel.css">
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- Firebase UI -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
</head>

<body>

    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDFNILGe3gLnCKL--o2_aKiaeGXAPShX6c",
            authDomain: "website-833a3.firebaseapp.com",
            databaseURL: "https://website-833a3.firebaseio.com",
            projectId: "website-833a3",
            storageBucket: "website-833a3.appspot.com",
            messagingSenderId: "509175153188",
            appId: "1:509175153188:web:4925cb3d62a502583bceb1",
            measurementId: "G-52R17M2EY6"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>



    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <section class="fxt-template-animation fxt-template-layout7" data-bg-image="./img/regbg.png">
        <div class="container">
            <div class="row align-items-center justify-content-center">
                <div class="col-xl-6 col-lg-7 col-sm-12 col-12 fxt-bg-color">
                    <div class="fxt-content">
                        <div class="fxt-header">
                            <a href="login-7.html" class="fxt-logo"><img src="img/logo-7.png" alt="Logo"></a>
                            <p>Login with US</p>
                        </div>
                        <div class="fxt-form">
                            <form method="POST">
                                <p id="success" class="form-group" style="color: green;"></p>
                                <p id="error" class="form-group" style="color: red;"></p>
                                <div class="form-group">
                                    <div class="fxt-transformY-50 fxt-transition-delay-1">
                                        <input type="email" id="email" class="form-control" name="email"
                                            placeholder="Email" required="required">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="fxt-transformY-50 fxt-transition-delay-2">
                                        <input id="password" type="password" class="form-control" name="password"
                                            placeholder="********" required="required">
                                        <i toggle="#password" class="fa fa-fw fa-eye toggle-password field-icon"></i>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="fxt-transformY-50 fxt-transition-delay-3">
                                        <div class="fxt-checkbox-area">
                                            <div class="checkbox">
                                                <a href="forgot-password-7.html" class="switcher-text">Forgot Password</a>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="fxt-transformY-50 fxt-transition-delay-4">
                                        <button id="loginSubmit" class="fxt-btn-fill">Log in</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="fxt-style-line">
                            <div class="fxt-transformY-50 fxt-transition-delay-5">
                                <h3>Or Login With</h3>
                            </div>
                        </div>
                        <div id="firebaseui-auth-container"></div>
                        <div class="fxt-footer">
                            <div class="fxt-transformY-50 fxt-transition-delay-9">
                                <p>Don't have an account?<a href="./register.html" class="switcher-text2">Register</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- jquery-->
    <script src="./javascript/jquery-3.5.0.min.js"></script>
    <!-- Popper js -->
    <script src="./javascript/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="./javascript/bootstrap.min.js"></script>
    <!-- Imagesloaded js -->
    <script src="./javascript/imagesloaded.pkgd.min.js"></script>
    <!-- Validator js -->
    <script src="./javascript/validator.min.js"></script>
    <!-- Custom Js -->
    <script src="./javascript/main.js"></script>
    <script src="./javascript/login.js"></script>

    <script>
        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        var uiConfig = {
            callbacks: {
                signInSuccessWithAuthResult: async function (authResult, redirectUrl) {
                    
                    let body = {
                        'firstName': authResult.user.displayName,
                        'email': authResult.user.email
                    }
                    let exist = false
                    await axios.get(`/api/auth/isOldUser/${body.email}`).then(res=>{
                        exist = res.data.exist
                    })

                    if (exist) {
                        // If User already exist
                        // Login
                        await axios({
                            headers: {
                                "Content-type": "application/json",
                            },
                            method: "post",
                            url: "/api/auth/OAuth",
                            data: body,
                            withCredentials: true,
                        })
                            .then((res) => {
                                document.getElementById("error").innerHTML = "";
                                document.getElementById("success").innerHTML = "Login Successful";
                                localStorage.setItem('admin', res.data.user.admin)
                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    } else {
                        // If User don't exist
                        // Register
                        await axios({
                            headers: {
                                "Content-type": "application/json",
                            },
                            method: "post",
                            url: "/api/auth/signup",
                            data: body,
                        })
                            .then((res) => {
                                // Login
                                axios({
                                    headers: {
                                        "Content-type": "application/json",
                                    },
                                    method: "post",
                                    url: "/api/auth/OAuth",
                                    data: body,
                                    withCredentials: true,
                                })
                                    .then((res) => {
                                        document.getElementById("error").innerHTML = "";
                                        document.getElementById("success").innerHTML = "Login Successful";
                                        localStorage.setItem('admin', res.data.user.admin)
                                    })
                                    .catch((err) => {
                                        console.log(err);
                                    });

                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    }
                },
            },
            signInFlow: 'popup',
            signInOptions: [
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                firebase.auth.FacebookAuthProvider.PROVIDER_ID,
            ],
            // Terms of service url.
            tosUrl: '<your-tos-url>',
            // Privacy policy url.
            privacyPolicyUrl: '<your-privacy-policy-url>'
        };
        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);
    </script>

</body>



</html>
